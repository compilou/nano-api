<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: test/01_unit/01_check_route_injection.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: test/01_unit/01_check_route_injection.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const log = require('why-is-node-running');
const Controller = require('../../src/controllers/controller');

const {
  // λ,
  expect
} = require('src/...');

var Router = require('../../src/routes');
var Routes = {
  list: {},
  log: (...msg) => !!msg,
  Server: ((...verbs) => {
    const tmp = {};
    verbs.forEach((verb) => tmp[verb] = (name, body) => {
      if (!Routes[name.replace(/^\//, '')]) {
        Routes[name.replace(/^\//, '')] = {};
      }
      Routes[name.replace(/^\//, '')][verb] = body;
    });
    return tmp;
  })('get', 'post', 'options', 'put', 'patch', 'delete'),
};

var AvailableRoutes = {
  Auth: require('../../src/controllers/auth'),
  Deliberation: require('../../src/controllers/deliberation'),
  Meeting: require('../../src/controllers/meeting'),
  User: require('../../src/controllers/user'),
  Vote: require('../../src/controllers/vote'),
};


/**
 * @description Dummy Controller class
 *
 * @class DummieController
 * @extends {Controller}
 */
class DummieController extends Controller {

  /**
   * @description Dummy method for testing injection.
   *
   * @param {any} req Express Request object.
   * @param {any} res Express Response object.
   *
   * @memberOf DummieController
   */
  options(req, res) {
    res(req);
  }

  /**
   * @description Dummy method for testing purposes.
   *
   * @param {any} ok Any data to be returned.
   * @returns {any}
   *
   * @memberOf DummieController
   */
  notInjectable(ok) {
    return ok();
  }
}



'Valida Router.'
  .testList(function () {

    'Teste de injeção'
      .test((done) => {
        Router(Routes, {
          Test: DummieController
        });
        expect(Routes.Test).to.not.have.property('notInjectable');
        expect(Routes.Test).to.have.property('options');
        Routes.Test.options('/', done);
      });


    context('Possíveis questões a serem abordadas em um ambiente mais realista', function () {
      'Valida emissão de eventos pro Socket.IO'.test(function (done) { this.skip(); done(); });
      'Segurança do cookie/sessão'.test(function (done) { this.skip(); done(); });
      'Repressão/limite de acesso (anti-abuso)'.test(function (done) { this.skip(); done(); });
      'Cluster não gerencia a quantidade real/total de usuários conectados (acima de 40k)'.test(function (done) { this.skip(); done(); });
    });

    context('Métodos definidos nos controllers', function () {
      Object.keys(AvailableRoutes).forEach((controller) => {

        `Avaliando métodos de ${controller}`
          .test((next) => {
            Router(Routes, { [controller]: AvailableRoutes[controller] });
            expect(Routes[controller]).to.have.property('get');
            next();
          });
      });
    });

    after((quit) => {
      setTimeout(function () {
        log(); // logs out active handles that are keeping node running
        quit();
      }, 1000);
    });
  });
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="DummieController.html">DummieController</a></li><li><a href="Meeting.html">Meeting</a></li><li><a href="ORM.html">ORM</a></li><li><a href="ORM.ORM.html">ORM</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Mon Jun 01 2020 02:46:06 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
